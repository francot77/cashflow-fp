{% extends "layout.html" %}
{% block title %}Dashboard - Cashflow{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">Summary {{ month }}/{{ year }}</h1>
  <form class="d-flex" method="get" action="{{ url_for('views.index') }}">
    <input class="form-control me-2" type="number" name="month" min="1" max="12" placeholder="Month" value="{{ month }}">
    <input class="form-control me-2" type="number" name="year" min="2000" max="2100" placeholder="Year"
      value="{{ year }}">
    <button class="btn btn-outline-primary" type="submit">Change</button>
  </form>
</div>

<div class="row mb-4">
  <div class="col-md-4 mb-3">
    <div class="card border-success">
      <div class="card-body">
        <h5 class="card-title text-success">Income</h5>
        <p class="card-text fs-4">+ $ {{ "%.2f"|format(total_income) }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-danger">
      <div class="card-body">
        <h5 class="card-title text-danger">Expenses</h5>
        <p class="card-text fs-4">- $ {{ "%.2f"|format(total_expense) }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card border-info">
      <div class="card-body">
        <h5 class="card-title">Balance</h5>
        {% set balance_class = "text-success" if balance >= 0 else "text-danger" %}
        <p class="card-text fs-4 {{ balance_class }}">
          {{ "+ $" if balance >= 0 else "- $" }}{{ "%.2f"|format(balance|abs) }}
        </p>
      </div>
    </div>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-2">
  <h2 class="h5 mb-0">Transactions this month</h2>
  <a href="{{ url_for('views.add') }}" class="btn btn-primary btn-sm">+ New transaction</a>
</div>

{% if rows %}
<div class="table-responsive">
  <table class="table table-striped table-sm align-middle mt-2">
    <thead>
      <tr>
        <th>Date</th>
        <th>Type</th>
        <th>Description</th>
        <th>Category</th>
        <th class="text-end">Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row["date"] }}</td>
        <td>
          {% if row["type"] == "income" %}
          <span class="badge bg-success">Income</span>
          {% else %}
          <span class="badge bg-danger">Expense</span>
          {% endif %}
        </td>
        <td>{{ row["description"] or "-" }}</td>
        <td>{{ row["category"] }}</td>
        <td class="text-end">
          {% if row["type"] == "income" %}
          <span class="text-success">+ $ {{ "%.2f"|format(row["amount"]) }}</span>
          {% else %}
          <span class="text-danger">- $ {{ "%.2f"|format(row["amount"]) }}</span>
          {% endif %}
        </td>
        <td>

          <a href="{{ url_for('views.edit_transaction', tx_id=row.id) }}" class="btn btn-sm btn-outline-primary">
            Edit
          </a>


          <form action="{{ url_for('views.delete_transaction', tx_id=row.id) }}" method="post" style="display:inline"
            onsubmit="return confirm('Are you sure you want to delete this transaction?');">
            <button type="submit" class="btn btn-sm btn-outline-danger">
              Delete
            </button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p class="text-muted mt-3">No transactions registered for this month.</p>
{% endif %}
{% endblock %}